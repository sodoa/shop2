/*! js weidian 2015-05-08 */
Item.videoAndItemLink=function(){function a(a,b){if(a&&b){console.log("has video");var d=($("#video_wrap").html("<em style='background-image:url("+a+")' id='video_thumb'>&nbsp;</em> <video id='video' width='100%' height='100%' loop controls poster='' src='"+b+"'></video> <div id='video_btn_wrap'><em id='video_btn_a'>&nbsp;</em> <em id='video_btn_b'>&nbsp;</em></div>").show(),$$("#video"));$("#video_btn_wrap").bind("click",function(){d.paused?(d.requestFullscreen?d.requestFullscreen():d.msRequestFullscreen?d.msRequestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitSupportsFullscreen?("com.koudai.weishop"!=M.getCookie("from_appid")||!M.isAndroid())&&d.webkitEnterFullscreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),M.isAndroid()?d.play():setTimeout(function(){d.play()},1e3)):d.pause()}),$("#video").bind("pause",function(){$(this).removeClass("show_video"),$("#video_thumb").show(),$("#video_btn_a").show().next().show(),d.pause()}),$("#video").bind("playing",function(){c&&(M.gaq("详情-播放"),c=!1),$(this).addClass("show_video"),$("#video_thumb").hide(),$("#video_btn_a").hide().next().hide(),d.play()})}else console.log("满足匹配 但是没有找到数据 url")}var b=Item.itemName,c=!0,d=new RegExp(/(http:\/\/www.meipai.com\/media\/){1}[1-9]{1}[0-9]*/i),e=new RegExp(/(http:\/\/){0,1}(wd.koudai.com\/){1}((i\/)|((vshop\/1\/H5\/)?item.html[?]itemID=)){1}([1-9]{1}[0-9]*)([a-zA-Z0-9?&=%.-_#])*/i),f=new RegExp(/(v.qq.com\/){1}([a-zA-Z0-9?&=%.-_#])*/i);if(e.test(b)){console.log("匹配_link 至少一次");var g="",h=0;!function(a){var c=arguments;e.test(a)?a.replace(e,function(a){var d=a.toString().length;temp_d="<a href='"+(-1===a.toLowerCase().indexOf("http://")?"http://"+a:a)+"' style='color:blue'>"+a+"</a>",sub_str=b.substr(h),g=g+sub_str.substr(0,sub_str.indexOf(a))+temp_d,h=h+sub_str.substr(0,sub_str.indexOf(a)).length+d,c.callee(b.substr(h))}):g+=a}(b),$("#item_name").html(g)}else console.log("不匹配 link");d.test(b)?b.replace(d,function(c){console.log("##video= "+c),Item.itemName=b.replace(c,""),$("#item_name").html(Item.itemName),document.title=Item.itemName.replace(/<br \/>/g,""),M.jsonp("http://meipai.com/medias/api_show_in_weibo?url="+encodeURIComponent(c),function(b){console.log(b);var c=b.image,d=b.stream;if(c&&d){var e=c.url,f=d.url;a(e,f)}else console.log("满足匹配 但是没有找到数据 wrap")})}):console.log("不满足匹配 描述里没有视频地址"),f.test(b)&&b.replace(f,function(c){var d=c.split("?")[0];d=d.split("/");var e=d.length,f=d[e-1];f=f.replace(".html",""),Item.itemName=b.replace(c,""),Item.itemName=Item.itemName.replace("http://m.",""),$("#item_name").html(Item.itemName),document.title=Item.itemName.replace(/<br \/>/g,""),M.jsonp("http://vv.video.qq.com/getinfo?&vids="+f+"&platform=101001&charge=0&otype=json",function(b){if(b.vl.vi[0].fvkey){var c=b.vl.vi[0];console.log(c);var d="http://vliveachy.tc.qq.com/videoctfs.tc.qq.com/"+c.fn+"?vkey="+c.fvkey;M.jsonp("http://ncgi.video.qq.com/tvideo/fcgi-bin/vp_iphone?plat=2&otype=json&vid="+f,function(b){var c="http://wd.geilicdn.com/vshop-shop-logo-default.jpg";b.video.pic&&(c=b.video.pic),a(c,d)})}})})},Item.videoAndItemLink();