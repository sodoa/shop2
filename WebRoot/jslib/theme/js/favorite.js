/*! js weidian 2015-05-12 */
!function(){function a(a){var d={buyer_id:M.getCookie("WD_b_id"),wduss:M.getCookie("WD_b_wduss"),obj_type:a,obj_id:g};M.jsonp("http://wd.koudai.com/wd/favorite/check?param="+M.toJSON(d),function(a){var d=a.result;1==d&&c.addClass(b).html("已收藏")})}var b=window.storedClass||"fav_un",c=window.storeContainer||$("#favorite");if(M.isLogin()){var d=M.urlQuery("userid"),e=M.urlQuery("itemID"),f="",g="";d&&(f="shop",g=d),e&&(f="item",g=e),a(f)}c.bind("click",function(){if(!M.isLogin())return void M.doLogin();var a=$(this);if(!a.hasClass("isLoading")){a.addClass("isLoading");var c={buyer_id:M.getCookie("WD_b_id"),wduss:M.getCookie("WD_b_wduss"),obj_type:f,obj_id:g,appid:"h5.geili.glmi"};a.hasClass(b)?M.jsonp("http://wd.koudai.com/wd/favorite/cancel?param="+M.toJSON(c),function(){if($(".store span").length()?a.removeClass(b).addClass("favorite"):a.removeClass(b).addClass("favorite").html("收藏"),M._alert("取消收藏成功",function(){a.removeClass("isLoading"),window.updateingItemTips=!1}),"shop"==f&&$("#hd_fav_count_em").length()){var c=$("#hd_fav_count_em"),d=Number(c.html()),e=d-1;e>=0&&c.html(e)}}):M.jsonp("http://wd.koudai.com/wd/favorite/add?param="+M.toJSON(c),function(){if("item"==f&&M.trackVisit({track_type:93,item_id:g,user_id:M.getCookie("WD_seller")}),$(".store span").length()?a.removeClass("favorite").addClass(b):a.removeClass("favorite").addClass(b).html("已收藏"),M._alert("收藏成功",function(){a.removeClass("isLoading"),window.updateingItemTips=!1}),"shop"==f&&$("#hd_fav_count_em").length()){var c=$("#hd_fav_count_em"),d=Number(c.html()),e=d+1;e&&c.html(e).parent().show().addClass("hd_info_childrens"),$("#index_hd_shop_info").addClass("index_hd_shop_info_line"+$(".hd_info_childrens").length())}M.gaq("shop"==f?"店铺收藏成功":"商品收藏成功")})}})}();